<p id="notice"><%= notice %></p>

<h1>トイレ一覧</h1>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>トイレ名称</th>
      <th>多目的トイレ</th>
      <th>[男]小便器数</th>
      <th>[男]個室数</th>
      <th>[男]ウォシュレット</th>
      <th>[女]個室数</th>
      <th>[女]ウォシュレット</th>
      <th>オープン時間</th>
      <th>クローズ時間</th>
      <th>備考</th>
      <th>緯度</th>
      <th>経度</th>
      <th>User_id</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @toilets.each do |toilet| %>
      <tr>
        <td><%= toilet.id %></td>
        <td><%= toilet.toilet_name %></td>
        <td><%= toilet.multipurpose %></td>
        <td><%= toilet.m_urinal %></td>
        <td><%= toilet.m_room %></td>
        <td><%= toilet.m_washlet %></td>
        <td><%= toilet.w_room %></td>
        <td><%= toilet.w_washlet %></td>
        <td><%= toilet.open_time %></td>
        <td><%= toilet.close_time %></td>
        <td><%= toilet.remark %></td>
        <td><%= toilet.latitude %></td>
        <td><%= toilet.longtitude %></td>
        <td><%= toilet.user_id %></td>
        <td><%= link_to 'Show', toilet %></td>
        <td><%= link_to 'Edit', edit_toilet_path(toilet) %></td>
        <td><%= link_to 'Destroy', toilet, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'トイレ情報を登録する', new_toilet_path %>


<!-- 以下、GooglemapAPIテスト記述 -->

<h2>gmap</h2>
<div id='map_index'></div>

<style>
#map_index{
  height: 400px;
}
</style>


<script>
var map
var marker = [];
var infoWindow = [];
var markerData = gon.toilets; // コントローラーで定義したインスタンス変数を変数に代入
var toilet_name = [];
var toilet_lat = [];
var toilet_lng = [];

// GoogleMapを表示する関数(callback処理で呼び出される)
function initMap(){
  // ビューのid='map_index'の部分にGoogleMapを埋め込む
  map = new google.maps.Map(document.getElementById('map_index'), {
    center: { lat: 35.661, lng: 139.667 }, // 下北沢駅を中心
    zoom: 12
  });

  // 繰り返し処理でマーカーと吹き出しを複数表示させる
  for (var i = 0; i < markerData.length; i++) {
    // 各地点の緯度経度を算出
    markerLatLng = new google.maps.LatLng({
      lat: markerData[i]['latitude'],
      lng: markerData[i]['longitude']
    });

    // マーカーの表示
    marker[i] = new google.maps.Marker({
      position: markerLatLng,
      map: map
    });

    // 吹き出しの表示
    // let id = markerData[i]['id']
    // toilet_name[i]= markerData[i]['name'];
    // toilet_lat[i]= markerData[i]['latitude'];
    // toilet_lng[i]= markerData[i]['longitude'];
    // infoWindow[i] = new google.maps.InfoWindow({
      // 吹き出しの中身, 引数で各属性の配列と配列番号を渡す
    //  content: `<a href='/places/${ id }'>${ markerData[i]['name'] }</a><input type="button" value="追加" onclick="addPlace(toilet_name, toilet_lat, toilet_lng, ${i})">`
    //});
    markerEvent(i);
  }
}

// マーカーをクリックしたら吹き出しを表示
// function markerEvent(i) {
  // marker[i].addListener('click', function () {
  //  infoWindow[i].open(map, marker[i]);
  // });
// }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDgk50-Uh4K60ddzGNY5yOcfx4clQMNYNU&callback=initMap" async defer></script>
